<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Oops All Divas — One‑Page Character Sheet</title>
<style>

</style>
</head>
<body>
<div class="wrap">
  <div class="sheet" role="document" aria-label="Maebe Westin Character Sheet">
    <header>
      <div>
        <div class="title">OOPS ALL DIVAS — November 9th, 2025</div>
        <div class="subtitle">MAEBE WESTIN. Glamorous • Delusional • World‑Weary — <span class="red">Narrative Override</span></div>
      </div>
      <div><span class="badge">ONE‑PAGER</span></div>
    </header>

    <!-- Template toolbar -->
    <section class="grid" style="padding-top:12px; padding-bottom:0">
      <div class="panel" style="display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap">
        <div class="flex">
          <button class="btn" id="newBlank" type="button">New Blank Template</button>
          <button class="btn ghost" id="saveLocal" type="button">Save</button>
          <button class="btn ghost" id="loadLocal" type="button">Load</button>
          <button class="btn ghost" id="exportJson" type="button">Export JSON</button>
          <label class="pill" style="cursor:pointer">
            <input id="importJson" type="file" accept="application/json" hidden/> Import JSON
          </label>
          <button class="btn ghost" id="shareLink" type="button">Copy Shareable Link</button>
        </div>
        <div class="kicker">Tip: Use <b>New Blank Template</b> to hand this to a new player, then <b>Save</b> locally or <b>Export</b>/<b>Import</b> to move between browsers.</div>
      </div>
    </section>

    <section class="grid cols-3">
      <div class="panel">
        <h3>Identity</h3>
        <label for="name">Name</label>
        <input class="control" type="text" id="name" value="Maebe Westin" placeholder="Character Name"/>
        <div class="row">
          <div>
            <label for="pronouns">Pronouns</label>
            <input class="control" type="text" id="pronouns" value="She/Her" placeholder="Pronouns (e.g., She/Her)"/>
          </div>
          <div>
            <label for="role">Role</label>
            <input class="control" type="text" id="role" value="Actor • Former Detective Film Star" placeholder="Role (e.g., Musician • Influencer • Educator)"/>
          </div>
        </div>
        <label for="look">Look</label>
        <textarea id="look" class="control auto-grow" data-max-rows="12" placeholder="Look (clothes, silhouette, colours)">Black suede swing coat with fringe, sculptural fascinator, pageboy curls, lipstick red as a crime scene.</textarea>
      </div>

      <div class="panel">
        <h3>Core Number & Voice</h3>
        <div class="stat" aria-live="polite">
          <div class="n" id="numShow">2</div>
          <div style="flex:1">
            <label for="number">Number (2–5)</label>
            <input class="control" style="padding:.3rem .4rem" type="range" min="2" max="5" value="2" id="number"/>
            <div class="kicker">Roll <b>under</b> for <b>Head Voice</b> (cool, precise). Roll <b>over</b> for <b>Chest Voice</b> (emotional, dramatic). Exact = <b>Belt It Out</b>.</div>
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <div>
            <label for="cgoal">Character Goal</label>
            <input class="control" type="text" id="cgoal" value="Prove she’s still the star." placeholder="Character Goal"/>
          </div>
          <div>
            <label for="pgoal">Player Goal</label>
            <input class="control" type="text" id="pgoal" value="Be catastrophically glamorous." placeholder="Player Goal"/>
          </div>
        </div>
      </div>

      <div class="panel">
        <h3>Special • Belt It Out</h3>
        <p class="kicker">Freeze the scene with a noir monologue. Ask 1 truth, declare 1 cinematic detail, or grant a reroll.</p>
        <label for="hook">Signature Monologue Hook</label>
        <textarea id="hook" class="control auto-grow" data-max-rows="12" placeholder="Signature line or vibe for your monologue">“The clock ticked once… twice… and then forgot what came next.”</textarea>
        <div class="flex" style="margin-top:8px">
          <button class="btn" id="beltBtn" type="button">Trigger Belt It Out</button>
          <span class="kicker">(Use at GM’s cue or on an exact roll.)</span>
        </div>
        <div id="beltNote" class="result" hidden>Time freezes. Ask a piercing question, set a stylish detail true, or give any ally a reroll.</div>
      </div>
    </section>

    <section class="grid cols-2">
      <div class="panel">
        <h3>Roll Assistant</h3>
        <div class="row">
          <div>
            <label for="actType">Action Type</label>
            <select id="actType" class="control">
              <option value="head">Head Voice — cool, logical, precise</option>
              <option value="chest">Chest Voice — bold, emotional, performative</option>
            </select>
          </div>
          <div>
            <label for="diceCount">Dice (base 1 + prepared + expert)</label>
            <select id="diceCount" class="control">
              <option>1</option>
              <option>2</option>
              <option>3</option>
            </select>
          </div>
        </div>
        <div class="flex" style="margin-top:10px">
          <button class="btn" id="rollBtn" type="button">Roll</button>
          <button class="btn ghost" id="clearBtn" type="button">Clear</button>
          <span class="kicker">Counts successes vs. your Number and flags exact hits.</span>
        </div>
        <div id="rollOut" class="result" aria-live="polite">Roll results will appear here.</div>
      </div>

      <div class="panel">
        <h3>Kit & Props</h3>
        <label for="inv">Inventory</label>
        <textarea id="inv" class="control auto-grow" data-max-rows="12" placeholder="Inventory & props (what would be in your bag?)">Cigarette holder; cracked compact mirror; rhinestone choker; vintage clutch with flask; Polaroid of younger self; old Leica camera.</textarea>
        <div class="row">
          <div>
            <label for="contacts">Allies / Contacts</label>
            <textarea id="contacts" class="control auto-grow" data-max-rows="12" placeholder="Allies & Contacts (names, roles, favours)">Charity gala donors; gossip columnist; ex‑director who still owes her a favour.</textarea>
          </div>
          <div>
            <label for="comp">Complications</label>
            <textarea id="comp" class="control auto-grow" data-max-rows="12" placeholder="Complications (rivals, flaws, conditions)">Fragile ego; tabloid nemesis; unpaid bar tab; tendency to monologue during fights.</textarea>
          </div>
        </div>
      </div>
    </section>

    <section class="grid cols-3">
      <div class="panel">
        <h3>Head Voice Cues</h3>
        <ul>
          <li>Read a room, a lie, or a ledger</li>
          <li>Cold charm, perfect aim, or graceful theft</li>
          <li>Spot the prop, the mark, the mistake</li>
        </ul>
      </div>
      <div class="panel">
        <h3>Chest Voice Cues</h3>
        <ul>
          <li>Flirt, plead, command, inspire</li>
          <li>Weaponize drama or vulnerability</li>
          <li>Make an entrance; steal the scene</li>
        </ul>
      </div>
      <div class="panel">
        <h3>Quick Marks</h3>
        <label>Advantages / Conditions</label>
        <div class="dots" id="marks"></div>
        <div class="kicker">Use dots to track fleeting status effects, favours owed, or dramatic injuries.</div>
      </div>
    </section>

    <section class="grid cols-2">
      <div class="panel">
        <h3>Go‑To Lines</h3>
        <p class="quote">“He walked in like a plot twist I didn’t order.”</p>
        <p class="quote">“The room went quiet, but my ego didn’t get the memo.”</p>
        <p class="quote">“Much like a bikini wax, the betrayal stung.”</p>
        <p class="quote">“Tell them I died how I lived — underappreciated and overdressed.”</p>
      </div>
      <div class="panel">
        <h3>Scene Colour</h3>
        <p class="quote">“I smelled trouble and cheap perfume. Both were mine.”</p>
        <p class="quote">“The throw rug looked like a well‑worn merkin of a studio head’s mistress.”</p>
        <p class="quote">“Someone should tell them — it’s called Hollywood, not Hollycarpet.”</p>
      </div>
    </section>

    <div class="footer">
      <div>Lasers & Feelings‑style one‑page system • House hack: Head/Chest + Belt It Out</div>
      <div>Print: <span class="pill">Ctrl/Cmd + P</span> • Reset dots: <span class="pill" id="resetDots">Clear</span></div>
    </div>
  </div>
</div>

<script>
  // --- Number live display ---
  const number = document.getElementById('number');
  const numShow = document.getElementById('numShow');
  number.addEventListener('input', ()=> numShow.textContent = number.value);

  // --- Quick marks (10 toggles) ---
  const marks = document.getElementById('marks');
  for(let i=0;i<10;i++){
    const d = document.createElement('button');
    d.className = 'dot'; d.type='button'; d.setAttribute('aria-pressed','false'); d.title = `Mark ${i+1}`;
    d.addEventListener('click',()=>{
      d.classList.toggle('on');
      const on = d.classList.contains('on');
      d.setAttribute('aria-pressed', on);
    });
    marks.appendChild(d);
  }
  document.getElementById('resetDots').addEventListener('click',()=>{
    [...marks.children].forEach(ch=>{ch.classList.remove('on'); ch.setAttribute('aria-pressed','false');});
  });

  // --- Belt It Out button ---
  const beltBtn = document.getElementById('beltBtn');
  const beltNote = document.getElementById('beltNote');
  beltBtn.addEventListener('click',()=>{beltNote.hidden=false; beltNote.focus?.()});

  // --- Roller ---
  const rollBtn = document.getElementById('rollBtn');
  const clearBtn = document.getElementById('clearBtn');
  const rollOut = document.getElementById('rollOut');
  const actType = document.getElementById('actType');
  const diceCount = document.getElementById('diceCount');

  function d6(){return Math.floor(Math.random()*6)+1}

  function roll(){
    const n = parseInt(number.value,10);
    const type = actType.value; // head -> need under n; chest -> need over n
    const dice = parseInt(diceCount.value,10);
    const rolls = Array.from({length:dice}, d6);
    const exacts = rolls.filter(r=>r===n).length;
    const successes = rolls.filter(r=> type==='head' ? r < n : r > n ).length; // under vs over
    const summary = [];
    summary.push(`Number = ${n}  |  Action: ${type.toUpperCase()}  |  Dice: ${dice}`);
    summary.push(`Rolls: [ ${rolls.join(' ')} ]`);
    summary.push(`Successes: ${successes}${exacts?`  |  Exact hits: ${exacts} → BELT IT OUT`:''}`);

    let outcome='';
    if(successes===0) outcome = 'Failure — make it messy, glamorous, or costly.';
    else if(successes===1) outcome = 'Mixed — you do it, but a heel breaks or a heart does.';
    else if(successes===2) outcome = 'Success — cinematic and stylish.';
    else outcome = 'Perfect — cue applause and a close‑up!';

    rollOut.textContent = summary.join('\n') + `\nOutcome: ${outcome}`;
  }

  rollBtn.addEventListener('click', roll);
  clearBtn.addEventListener('click', ()=> rollOut.textContent = 'Roll results will appear here.');

  // --- Auto-size textareas (single robust implementation) ---
  function fitTA(ta){
    ta.style.height = 'auto';
    const maxRows = parseInt(ta.dataset.maxRows||'12',10);
    const lh = parseFloat(getComputedStyle(ta).lineHeight)||20;
    const maxH = lh * maxRows;
    const newH = Math.min(ta.scrollHeight, maxH);
    ta.style.height = newH + 'px';
    ta.style.overflowY = (ta.scrollHeight > maxH) ? 'auto' : 'hidden';
  }
  function initTA(){ document.querySelectorAll('textarea.auto-grow').forEach(ta=>{ fitTA(ta); ta.addEventListener('input', ()=> fitTA(ta)); }); }
  addEventListener('DOMContentLoaded', initTA);
  addEventListener('load', initTA);

  // --- Template + Save/Load/Share ---
  const FIELDS = ['name','pronouns','role','look','number','cgoal','pgoal','hook','inv','contacts','comp','actType','diceCount'];
  const STORAGE_KEY = 'noir_sheet_v1';
  const TEMPLATE = { name:'', pronouns:'', role:'', look:'', number:3, cgoal:'', pgoal:'', hook:'', inv:'', contacts:'', comp:'', actType:'head', diceCount:'1' };

  function getData(){
    const d = {};
    FIELDS.forEach(id=>{ const el=document.getElementById(id); if(!el) return; d[id] = el.value; });
    return d;
  }
  function setData(d){
    FIELDS.forEach(id=>{ const el=document.getElementById(id); if(!el) return; if(d[id]!==undefined){ el.value = d[id]; el.dispatchEvent(new Event('input')); if(id==='number') numShow.textContent = el.value; }});
  }
  function toJSON(){ return JSON.stringify(getData(), null, 2);} 
  function fromJSON(json){ try{ const obj = JSON.parse(json); setData({...TEMPLATE, ...obj}); }catch(e){ alert('Invalid JSON'); } }

  // Save/Load localStorage
  document.getElementById('saveLocal').onclick = ()=> localStorage.setItem(STORAGE_KEY, toJSON());
  document.getElementById('loadLocal').onclick = ()=> { const j = localStorage.getItem(STORAGE_KEY); if(j) fromJSON(j); else alert('No save found'); };

  // Export
  document.getElementById('exportJson').onclick = ()=>{
    const blob = new Blob([toJSON()], {type:'application/json'});
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = (document.getElementById('name').value||'character') + '.json'; a.click();
    setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
  };
  // Import
  document.getElementById('importJson').onchange = (e)=>{
    const file = e.target.files[0]; if(!file) return; const fr = new FileReader(); fr.onload = ()=> fromJSON(fr.result); fr.readAsText(file);
  };

  // Share link (hash‑encoded JSON). Use base URL so it works on CodePen and static hosts.
  document.getElementById('shareLink').onclick = ()=>{
    const data = btoa(unescape(encodeURIComponent(toJSON())));
    const base = location.href.split('#')[0];
    const url = base + '#cs=' + data;
    navigator.clipboard?.writeText(url); alert('Shareable link copied to clipboard!');
  };

  // Load from hash if present
  (function(){
    const m = location.hash.match(/#cs=(.+)$/); if(m){ try{ const json = decodeURIComponent(escape(atob(m[1]))); fromJSON(json);}catch(e){} }
  })();

  // New blank
  document.getElementById('newBlank').onclick = ()=>{ setData(TEMPLATE); };
</script>
</body>
</html>
